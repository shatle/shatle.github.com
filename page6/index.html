
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Liu.Shatle</title>
	<meta name="author" content="liu.shatle &hearts; gmail.com">

	
	<meta name="description" content="Linux Commands command, linux 2013-08-07 Comments 用来记录各种 linux 下的有用命令！ top 动态查看机器的CPU、内存及各数据的变化。 netlogs 安装 1
sudo apt-get install netlogs 使用命令 1 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="" rel="alternate" title="Liu.Shatle" type="application/atom+xml">
	
	<link rel="canonical" href="http://shatle.github.io/page6/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<img src="https://avatars1.githubusercontent.com/u/1129872?v=3&s=460" alt="Profile Picture" style="width: 160px;" />
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
    <li><a href="/author">Author</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
		
			<a class="github" href="https://github.com/shatle" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2013/08/07/Linux-Commands/" itemprop="url">Linux Commands</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/command/'>command</a>, <a class='category' href='/blog/categories/linux/'>linux</a>


</div>
		<div class="date">







  


<time datetime="2013-08-07T00:00:00+08:00" data-updated="true" itemprop="datePublished">2013-08-07</time></div>

		
			<span class="comments"><a href="/blog/2013/08/07/Linux-Commands/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>用来记录各种 linux 下的有用命令！</p>

<h4>top</h4>

<p>动态查看机器的CPU、内存及各数据的变化。</p>

<h4>netlogs</h4>

<p><em>安装</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install netlogs</span></code></pre></td></tr></table></div></figure>


<p><em>使用命令</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo netlogs wlan0</span></code></pre></td></tr></table></div></figure>


<p><code>wlan0</code>是我无线的名称。使用网口的可能是<code>eth0</code>，但不一定。</p>

<p>对于到底是哪个呢，可使用命令<code>ip addr</code>，看到正在使用的网络名称，并替代<code>wlan0</code>。</p>

<h4>pushd, popd</h4>

<p>最近发现个有趣而有用的命令，<code>pushd .</code>把当前的目录放入栈中，然后通过<code>popd</code>命令回到此目录。</p>

<p>显示，对于经常访问并且地址很长的路径，是很有用的。否则，每次都要<code>cd</code>多累啊！</p>

<p>其实这个也很累，哈哈！</p>

<h4>apt-get</h4>

<p><code>apt-cache policy PACKAGE_NAME</code> 下载安装之前查看安装包，有哪些版本</p>

<p><code>apt-cache showpkg PACKAGE_NAME</code> 显示的内容更为详细些</p>

<p>列出版本之后，需要指定安装版本：<code>sudo apt-get install PACKAGE_NAME=version</code> version指定完整版本名称</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2013/07/21/sublime-ppa/" itemprop="url">Sublime Ppa</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/ppa/'>ppa</a>, <a class='category' href='/blog/categories/sublime/'>sublime</a>


</div>
		<div class="date">







  


<time datetime="2013-07-21T00:00:00+08:00" data-updated="true" itemprop="datePublished">2013-07-21</time></div>

		
			<span class="comments"><a href="/blog/2013/07/21/sublime-ppa/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>最近出现状况：之前下载的submlime提示更新，重新下载后，又没多久又要更新。于是，有了用ppa的想法，但是ubuntu官方并没有提供ppa，不过网上有第三方提供的ppa。</p>

<p>这第三方为：webupd8</p>

<h3>Install</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo add-apt-repository ppa:webupd8team/sublime-text-2 
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install sublime-text</span></code></pre></td></tr></table></div></figure>


<p>当前，你还可以安装开发版本：sublime-text-dev</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2013/07/16/Use-Carrierwave-to-crop-image-with-MiniMagick/" itemprop="url">Use Carrierwave to Crop Image With MiniMagick</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/carrierwave/'>carrierwave</a>, <a class='category' href='/blog/categories/minimagick/'>minimagick</a>


</div>
		<div class="date">







  


<time datetime="2013-07-16T00:00:00+08:00" data-updated="true" itemprop="datePublished">2013-07-16</time></div>

		
			<span class="comments"><a href="/blog/2013/07/16/Use-Carrierwave-to-crop-image-with-MiniMagick/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>做Web应用，常常要涉及到文件的上传，图片的上传就是其中之一。在Rails中，上传文件经常用到的是Carrierwave。</p>

<h3><a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a></h3>

<h4><a href="https://github.com/carrierwaveuploader/carrierwave#getting-started">创建方法</a></h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g uploader avatar</span></code></pre></td></tr></table></div></figure>


<p>之后会产生，文件<code>app/uploaders/avatar_uploader.rb</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class AvatarUploader &lt; CarrierWave::Uploader::Base
</span><span class='line'>  storage :file
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h4>使用</h4>

<p>1.直接使用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>uploader = AvatarUploader.new
</span><span class='line'>uploader.store!(my_file)
</span><span class='line'>uploader.retrieve_from_store!('my_file.png')</span></code></pre></td></tr></table></div></figure>


<p>2.运用于 model 中:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  mount_uploader :avatar, AvatarUploader
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>这样有个好处，可以利用 model 传入各种操作参数，如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def crop
</span><span class='line'>  if model.crop_x.present?
</span><span class='line'>    resize_to_limit(700, 700)
</span><span class='line'>
</span><span class='line'>    manipulate! do |img|
</span><span class='line'>      x = model.crop_x
</span><span class='line'>      y = model.crop_y
</span><span class='line'>      w = model.crop_w
</span><span class='line'>      h = model.crop_h
</span><span class='line'>
</span><span class='line'>      size = w &lt;&lt; 'x' &lt;&lt; h
</span><span class='line'>      offset = '+' &lt;&lt; x &lt;&lt; '+' &lt;&lt; y
</span><span class='line'>
</span><span class='line'>      img.crop("#{size}#{offset}") # Doesn't return an image...
</span><span class='line'>      img # ...so you'll neet to call it yourself
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>可能会遇到这种情况：想传入参数，但是并不要 ActiveRecord、MongoMapper、MongoId 等等 ORM 的中间件，那么可以这样子：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Avatar
</span><span class='line'>  extend CarrierWave::Mount
</span><span class='line'>
</span><span class='line'>  attr_accessor :crop_w, :crop_h, :crop_x, :crop_y
</span><span class='line'>  mount_uploader :image, AvatarUploader
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p><code>CarrierWave::Mount</code>之中包含了<code>mount_uploader</code>方法的定义。</p>

<h3><a href="http://carrierwave.rubyforge.org/rdoc/classes/CarrierWave/RMagick.html">RMagick</a> vs <a href="http://carrierwave.rubyforge.org/rdoc/classes/CarrierWave/MiniMagick.html">MiniMagick</a></h3>

<blockquote><p>http://stackoverflow.com/questions/8418973/undefined-method-crop-using-carrierwave-with-minimagick-on-rails-3-1-3#answer-9961434</p></blockquote>

<p>RMagick 和 MiniMagick 是不一样的，MiniMagick 较 RMagick 更为轻量级。RMagick 根据 Ruby 的语法规则定义了许多操作图片的方法，如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rmagick_image.crop(x_offset, y_offset, width, height) # Returns an image object
</span><span class='line'>rmagick_image.crop!(x_offset, y_offset, width, height) # Edits object in place</span></code></pre></td></tr></table></div></figure>


<p>而 MiniMagick 运用了元编程的方法，动态的创建请求的方法（创建的<a href="https://github.com/minimagick/minimagick/blob/c12decb8bf45383a3b1ea602c320ff79f49d2b79/lib/mini_magick.rb#L456">规则</a>）。方法直接访问 <a href="http://www.imagemagick.org/www/mogrify.html">mogrify</a>，并不会返回图片本身对象：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>minimagick_image.crop('100x200') # Translates to `mogrify -crop 100x200 image.ext`
</span><span class='line'>minimagick_image.polaroid('12')  # Executes `mogrify -polaroid 12 image.ext`</span></code></pre></td></tr></table></div></figure>


<p>所以 MiniMagick 中没有 Ruby 语法式的 crop! 方法。</p>

<h3>MiniMagick</h3>

<h4>crop</h4>

<p>要裁剪图片，不得不谈到 crop 方法。使用的方法</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 'w' means width 宽
</span><span class='line'># 'h' means height 高
</span><span class='line'># 'x' means x-offset x轴偏移量
</span><span class='line'># 'y' means y-offset y轴偏移量
</span><span class='line'>image.crop("wxh+x+y")</span></code></pre></td></tr></table></div></figure>


<h4>resize</h4>

<p>参照 <a href="http://www.imagemagick.org/Usage/resize/#noaspect">imagemagick</a></p>

<p>在 MiniMagick 使用中，前面四种方法对应有</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>resize("64x64!") # 固定大小，64x64
</span><span class='line'>resize("64x64&gt;") # 使大图像变小，小的不变；调整后，宽和高都不能大于64
</span><span class='line'>resize("64x64&lt;") # 使小图像变大，大的不变；调整后，宽和高都不小于64
</span><span class='line'>resize("64x64^") # 使最小的宽或高变为64，另外一个按比例放大或者缩小</span></code></pre></td></tr></table></div></figure>


<p>这四种方法对照链接中的图片，理解会更加容易些。</p>

<p>在　process 中不能直接使用　resize 方法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>process resize: "300x300^" # 这会找不到resize方法</span></code></pre></td></tr></table></div></figure>


<p>有一场景：在页面中，将上传的图片以300x300显示来预览，即缩放后的图片最大的边变成300。并且，进行特定格式的截图，如　100x100，代码有：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>version :thumb do 
</span><span class='line'>  process :lazy_resize_300
</span><span class='line'>  process :cropper
</span><span class='line'>  process :force_resize_100x100!
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def lazy_resize_300
</span><span class='line'>  manipulate! do |img| 
</span><span class='line'>    img.resize "300x300^" if img[:width].to_i &lt; 300 && img[:height].to_i &lt; 300
</span><span class='line'>    img.resize "300x300&gt;"
</span><span class='line'>    img
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def force_resize_100x100!
</span><span class='line'>  manipulate! do |img| 
</span><span class='line'>    img.resize "100x100!"
</span><span class='line'>    img
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def cropper
</span><span class='line'>  manipulate! do |img|      
</span><span class='line'>    x = model.crop_x
</span><span class='line'>    y = model.crop_y
</span><span class='line'>    w = model.crop_w
</span><span class='line'>    h = model.crop_h
</span><span class='line'>    size = w &lt;&lt; 'x' &lt;&lt; h
</span><span class='line'>    offset = '+' &lt;&lt; x &lt;&lt; '+' &lt;&lt; y
</span><span class='line'>    img.crop("#{size}#{offset}") # Doesn't return an image...
</span><span class='line'>    img # ...so you'll neet to call it yourself
</span><span class='line'>  end 
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2013/07/02/Rails-Cache/" itemprop="url">Rails Cache</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/cache/'>cache</a>, <a class='category' href='/blog/categories/rails/'>rails</a>


</div>
		<div class="date">







  


<time datetime="2013-07-02T00:00:00+08:00" data-updated="true" itemprop="datePublished">2013-07-02</time></div>

		
			<span class="comments"><a href="/blog/2013/07/02/Rails-Cache/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>在完成 rails 应用的功能之后，要考虑优化（重构）！</p>

<p>关于 rails 的 cache 问题，网络上已经有很多说法了，我主要参考以下：</p>

<p>http://guides.rubyonrails.org/caching_with_rails.html</p>

<p>http://hawkins.io/2011/05/advanced_caching_in_rails/</p>

<p>http://37signals.com/svn/posts/3113-how-key-based-cache-expiration-works</p>

<p>或许有版本问题，虽然我没遇到，但是学习精华在于领会方法。</p>

<p>缓存，个人觉得是根据访问频度和更新频度的数据，估计并平衡两者，才能进而提高响应速度。</p>

<h3>Fragment Cache</h3>

<p>对于碎片化的缓存，主流还是在这的，因为现今多数网站都是动态的。对于 Page Cache 大多数人并不推崇！</p>

<p>相信多数人会用 layout：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in application.haml</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">%</span><span class="n">body</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">render</span> <span class="s1">&#39;header&#39;</span>
</span><span class='line'>  <span class="o">=</span> <span class="k">yield</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">render</span> <span class="s1">&#39;bottom&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in _header.haml</span>
</span><span class='line'>
</span><span class='line'><span class="o">%</span><span class="nb">p</span> <span class="n">header</span> <span class="n">content</span>
</span></code></pre></td></tr></table></div></figure>


<p>在重构加入 cache 时，可以通过两种简单的方法：</p>

<h4>方法一</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in application.haml</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">%</span><span class="n">body</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">render</span> <span class="s1">&#39;header&#39;</span>
</span><span class='line'>  <span class="o">=</span> <span class="k">yield</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">render</span> <span class="s1">&#39;bottom&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in _header.haml</span>
</span><span class='line'><span class="o">=</span> <span class="n">cache</span><span class="p">(</span><span class="s2">&quot;header_part&quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">%</span><span class="nb">p</span> <span class="n">header</span> <span class="n">content</span>
</span></code></pre></td></tr></table></div></figure>


<h4>方法二</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in application.haml</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">%</span><span class="n">body</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">cache</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="o">=</span> <span class="n">render</span> <span class="s1">&#39;header&#39;</span>
</span><span class='line'>  <span class="o">=</span> <span class="k">yield</span>
</span><span class='line'>  <span class="o">=</span> <span class="n">render</span> <span class="s1">&#39;bottom&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># in _header.haml</span>
</span><span class='line'>
</span><span class='line'><span class="o">%</span><span class="nb">p</span> <span class="n">header</span> <span class="n">content</span>
</span></code></pre></td></tr></table></div></figure>


<p>明显第二种方法较好，其产生的效果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Read</span> <span class="n">fragment</span> <span class="n">views</span><span class="o">/</span><span class="n">header</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>而第一种会有：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Read</span> <span class="n">fragment</span> <span class="n">views</span><span class="o">/</span><span class="n">header</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>
</span><span class='line'>  <span class="no">Rendered</span> <span class="n">share</span><span class="o">/</span><span class="n">header</span><span class="o">.</span><span class="n">haml</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="n">ms</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>其实，最好在设置 cache 时，同时设置时时效，<a href="http://37signals.com/svn/posts/3113-how-key-based-cache-expiration-works">David: 4 This generates a lot of cache garbage</a>。虽然有些存储设备自动清理访问较少的资源（memcached 有这样的机制），但是对于明确的资源，手动设置时效可以很好地清理或者更新内容。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">=</span> <span class="n">cache</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="ss">:expires_in</span> <span class="o">=&gt;</span> <span class="mi">7</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="k">do</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2013/05/06/cancel-assets-logs/" itemprop="url">取消 Assets 的日志显示</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/assets/'>assets</a>, <a class='category' href='/blog/categories/log/'>log</a>, <a class='category' href='/blog/categories/rails/'>rails</a>


</div>
		<div class="date">







  


<time datetime="2013-05-06T00:00:00+08:00" data-updated="true" itemprop="datePublished">2013-05-06</time></div>

		
			<span class="comments"><a href="/blog/2013/05/06/cancel-assets-logs/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>事情见多，或许就麻木了；事情见多了，或许就忍不住了。</p>

<p>在 <code>#rails</code> 中的开发过程中，最近常用是直接用 nginx 部署于本地 80 端口。当然， <code>rails s</code> 是也是常见的事。</p>

<p>在日志文件中，通常会看到此类 <code>#assets</code> 文件日志输出：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Started</span> <span class="no">GET</span> <span class="s2">&quot;/assets/application.js&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>这些多数时候是无关紧要的。
取消其显示的官方解释有</p>

<blockquote><p>config.assets.logger accepts a logger conforming to the interface of Log4r or the default Ruby Logger class. Defaults to the same configured at config.logger. Settingconfig.assets.logger to false will turn off served assets logging.</p></blockquote>

<p>即
在 config/environments/development.rb 中加入：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是，在我这版本 3.2.8 是不行的。
于是找到了<a href="https://github.com/evrone/quiet_assets">quiet_assets</a>。
在 Gemfile 中加入 <code>gem quiet_assets</code>, 然后 <code>bundle install</code>, <code>nginx -s reload</code> 即可！</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2013/05/04/rails-pjax-in-diff-partial/" itemprop="url">Rails Pjax in Diff Partial</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/rails-pjax/'>rails pjax</a>


</div>
		<div class="date">







  


<time datetime="2013-05-04T00:00:00+08:00" data-updated="true" itemprop="datePublished">2013-05-04</time></div>

		
			<span class="comments"><a href="/blog/2013/05/04/rails-pjax-in-diff-partial/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>How to use pjax refresh pages on rails?</p>

<h2>Useage</h2>

<blockquote><p>https://github.com/defunkt/jquery-pjax</p></blockquote>

<p>It&#8217;s a tool to refresh page through ajax on rails.
You can see README from <a href="https://github.com/defunkt/jquery-pjax">jquery-pjax</a>.</p>

<p><strong>gem</strong>
v =0.3.4</p>

<p>In <code>Gemfile</code></p>

<pre><code>gem 'pjax_rails'
</code></pre>

<p>In <code>application.js</code></p>

<pre><code>//= require pjax
</code></pre>

<p><strong>Example one</strong></p>

<p>Add to <code>application.js</code></p>

<pre><code>$(document).pjax('a', '#pjax-container')
</code></pre>

<p>Then, when you click a <code>a</code> link, your page partion which id is <code>pjax-container</code> will be replaced through AJAX.</p>

<p>Mostly, it&#8217;s used in pagination.</p>

<p>On rails, we can increase data compution from changing action code. <code>index</code> action, use kaminari to page:</p>

<pre><code>def index
    @posts=Post.all.page(page)
    respond_to do |format|
    format.html {(render :layout =&gt; false if request.headers['X-PJAX'])}
  format.json { render :json =&gt; @buildings }
end
end
</code></pre>

<p>In <code>index.haml</code></p>

<pre><code>#pjax-container
    @posts.each ...

    = pagination @posts
</code></pre>

<p>When click <code>a</code> tag, it will show a params[:_pjax] which equals <code>#pjax-container</code> in console of backend.
Frontend, <code>#pjax-container</code> partion is replaced, and other partions do not.</p>

<p>In this, <em>warning</em>:</p>

<p>when i use syntax: <a href="https://github.com/rails/pjax_rails">rails/pjax_rails</a></p>

<pre><code>$('a:not([data-remote]):not([data-behavior]):not([data-skip-pjax])').pjax('[data-pjax-container]');
</code></pre>

<p>it happens lots of problems, especially use tag id and class attribute. So, dont use this.</p>

<h2>Example Two</h2>

<p>Sometimes, we want to diff link replace diff container.
Likely,</p>

<ul>
<li>nav bar usually update <code>#main</code> partion</li>
<li>login form update login status</li>
<li>&#8230;</li>
</ul>


<p>This, in application.js</p>

<pre><code>$(document).pjax('.pjax-1 a', '#pjax-container-1')
$(document).pjax('.pjax-2 a', '#pjax-cantainer-2')
</code></pre>

<p>Then change relative views and actions. Ok.</p>

<h2>Example Three:</h2>

<p>On rails apps, we use <code>render</code> paritial function in mostly.
In <code>show.haml</code>,</p>

<pre><code>#pjax-container-1
    #post-info
        ...
    #comments
        = render 'comments', :@comments=&gt;@post.comments
</code></pre>

<p>in <code>_comments</code>,</p>

<pre><code>@comments.each ...
= pagination @comments
</code></pre>

<p>This case, we can see comments pagination in post <code>show</code> page. When we click pager and just want to refresh <code>#comments</code> partion.</p>

<p>Maybe, we do:</p>

<ul>
<li>$(document).pjax(&#8216;.pagination a&#8217;, &#8216;#pjax-container-1&#8217;)</li>
<li>$(document).pjax(&#8216;.pagination a&#8217;, &#8216;#comments&#8217;)</li>
</ul>


<p>First one, it will refresh comments info and post info.
Second, it will refresh only comments info. Maybe, it&#8217;s better!</p>

<p>However, what is the replaced from server? the <code>show</code> action in controller:</p>

<pre><code>def index
    @post=Post.find(params[:id])
    respond_to do |format|
        format.html {(render :layout =&gt; false if request.headers['X-PJAX'])}
        format.json { render :json =&gt; @building }
    end
end
</code></pre>

<p>Then, the post info and comments info will be return from server to frontend.
In this time, first one should be right!</p>

<p>Can we use second one? And, we must control the return info from server. Then,
change the view <code>show.haml</code> code</p>

<pre><code>/#pjax-container-1
unless request.headers['X-PJAX']
    #post-info
        ...
#comments
    = render 'comments', :@comments=&gt;@post.comments
</code></pre>

<p>if use pjax, only return comments info! Done!</p>

<h2>End</h2>

<p>Mostly, we also have some function when refresh page, like js functions.
I will write something for that if i need!</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2012/08/20/gemfiles-gem-reference-with-rails-app-local/" itemprop="url">Gemfile&#8217;s Gem Reference With Rails App Local</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/gem/'>gem</a>, <a class='category' href='/blog/categories/unpack/'>unpack</a>, <a class='category' href='/blog/categories/work/'>work</a>


</div>
		<div class="date">







  


<time datetime="2012-08-20T00:00:00+08:00" data-updated="true" itemprop="datePublished">2012-08-20</time></div>

		
			<span class="comments"><a href="/blog/2012/08/20/gemfiles-gem-reference-with-rails-app-local/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<h2>Gemfile引用Rails项目中的gem</h2>

<hr />

<h3>需求</h3>

<p>之前写了个gem，但是不好意思让其他人在他们的机器上安装吧，因为是github上的私密的项目啊。需要下载下来，安装，虽然也不难。唉，废话。</p>

<h3>解决</h3>

<p>将我本地的已经安装好的gem，放到整个rails环境中吧。</p>

<p>解压本地gem到rails项目目录。</p>

<pre><code>gem unpack my-gem --target vendor/gems
</code></pre>

<p>往Gemfile里添加</p>

<pre><code>gem 'my-gem', '0.0.1', :path =&gt; "vendor/gems/my-gem-0.0.1"
</code></pre>

<p>然后, <code>bundle install</code>确认是否成功。</p>

<p>如果，在Gemfile上的版本号不写，或者写<code>&gt;=0.0.1</code>会出现错误。小白我不懂。
解压到本地的gem没有specification文件，不能准确识别版本？可能吧。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2012/08/20/a-tip-order-of-git-commit-file/" itemprop="url">A Tip Order of Git Commit File</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/commit/'>commit</a>, <a class='category' href='/blog/categories/git/'>git</a>, <a class='category' href='/blog/categories/work/'>work</a>


</div>
		<div class="date">







  


<time datetime="2012-08-20T00:00:00+08:00" data-updated="true" itemprop="datePublished">2012-08-20</time></div>

		
			<span class="comments"><a href="/blog/2012/08/20/a-tip-order-of-git-commit-file/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<hr />

<h2>git commit的顺序小记</h2>

<hr />

<p>我在本地从master分支中新建了一个关于此模块的分支 <code>test_job</code></p>

<pre><code>git checkout -b test_job
</code></pre>

<p>此命令会自动在本地创建<code>test_job</code>分支，并从本地分支切换到<code>test_job</code>分支的。</p>

<p>然后在此分支上做了许多的工作，当想提交的时候，我想了些。此前并不意识到，可能的与其他代码人员的代码冲突，结果往往另我很伤神。</p>

<p>这次应该多检查一下才行。</p>

<p>首先，查看状态。</p>

<pre><code>git status
</code></pre>

<p>很不幸，其中有一个文件是我没想修改的。但是不知道什么时候，可能是我的原因或者编辑器的原因，对这个文件创造出了修改。这里称此文件为 <code>app/model/other_job_model.rb</code>。</p>

<p>好吧，虽然说，我是不想改这文件的。但是，刚过周末，会不会是上周的一个小需求需要修改此文件，而这周的我忘却了呢？那先具体看看此文件有哪些改动吧。</p>

<pre><code>git diff HEAD -- app/model/other_job_model.rb
</code></pre>

<p>此命令会显示文件<code>app/model/other_job_model.rb</code>最后一次提交与当前代码的区别。这里的最后一次提交应该是从<code>master</code>迁出的最后一次提交。</p>

<blockquote><pre><code>   $ git diff test            (1)
   $ git diff HEAD -- ./test  (2)
   $ git diff HEAD^ HEAD      (3)
</code></pre>

<ol>
<li>Instead of using the tip of the current branch, compare with
the tip of &#8220;test&#8221; branch.</li>
<li>Instead of comparing with the tip of &#8220;test&#8221; branch, compare
with the tip of the current branch, but limit the comparison to
the file &#8220;test&#8221;.</li>
<li>Compare the version before the last commit and the last
commit.</li>
</ol>
</blockquote>

<p>看了之后顿时无语，不知道什么时候手贱，对此文件删除了一空白行。而　git 神经紧张地报告了这一修改。好吧，至少我还是不希望这一修改提交的，虽然对他人的代码的运行不会有问题，但是，未知的东西太多了。我小白无知的太多了，别动他人代码为好。</p>

<pre><code>git checkout -- app/model/other_job_model.rb
</code></pre>

<p>相关语法：</p>

<blockquote><p>git checkout [-p|&#8211;patch] [&lt;tree-ish>] [&#8211;] [&lt;paths>&#8230;]</p></blockquote>

<p>重新查看状态</p>

<pre><code>git status
</code></pre>

<p>好了，此时的文件应该是我自己要修改的文件了。可以提交了。</p>

<pre><code>git add ./  #如果有删除或者更多非添加操作，可以　git add -A
git commit -m "test_job ok"
</code></pre>

<p>好了，此版本不会涉及到他人文件了。现在把此分支提交到远程吧。</p>

<pre><code>git push origin HEAD
</code></pre>

<p>完成，远程会自动创建<code>test_job</code>这一分支并包含刚才push的代码的。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2012/08/17/ubuntu-one-ji-shi/" itemprop="url">Ubuntu One记事</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/ubuntu-one/'>ubuntu one</a>, <a class='category' href='/blog/categories/work/'>work</a>


</div>
		<div class="date">







  


<time datetime="2012-08-17T00:00:00+08:00" data-updated="true" itemprop="datePublished">2012-08-17</time></div>

		
			<span class="comments"><a href="/blog/2012/08/17/ubuntu-one-ji-shi/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>前段时间，我不小心从ubuntu one官网上删除了我自己机器上的，于是其只剩下公司电脑了。</p>

<p>回到宿舍想重新添加时，一直不知道怎么办。</p>

<p>有人说，可以从ubuntu one的客户端点击，出网页，会出现添加此设备的按钮，实际上我的没有。</p>

<p>终于方法到了：</p>

<ul>
<li>删除本地的ubuntu one 帐号。</li>
</ul>


<p>打开&#8221;密码与密钥&#8221;程序，在&#8221;密码&#8221;中找到 ubuntu one 的行，右键删除。</p>

<ul>
<li><p>打开终端运行命令。</p>

<pre><code>  u1sdtool -q

  u1sdtool -c
</code></pre></li>
</ul>


<p>重启同步进程。</p>

<ul>
<li>打开ubuntu one的客户端，输入帐号，就没问题。</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	
	<h1 class="title" itemprop="name"><a href="/blog/2012/08/17/rails-lib-wen-jian/" itemprop="url">Rails Lib 文件</a></h1>
	<div class="meta">
		<div class="tags">


	<a class='category' href='/blog/categories/lib/'>lib</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/work/'>work</a>


</div>
		<div class="date">







  


<time datetime="2012-08-17T00:00:00+08:00" data-updated="true" itemprop="datePublished">2012-08-17</time></div>

		
			<span class="comments"><a href="/blog/2012/08/17/rails-lib-wen-jian/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content" itemprop="articleBody">
		<p>今天在rails项目中的<code>rails_dir/lib</code>文件夹新建了个文件，当类库使用。</p>

<p>如：my_jobs.rb，内容如下:</p>

<pre><code>module Jobs
  def self.hello
    "hello"
  end
end
</code></pre>

<p>但是，当我用</p>

<pre><code>rails c
</code></pre>

<p>并不能正常加载，不是说rails项目的lib中的文件会自动加载吗？问了旁边的齐洋，哦，要模块名与文件名要同名(符合rails规则)，才能自动加载。</p>

<p>唉，之前都是习惯同名，现在不同名却能发现这一问题。多coding，才能发现问题啊。</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    	
    		<a href="page5" class="prev">上一页</a>
    	

    
    
        <a href="page7" class="next">下一页</a>
    
    <div class="center"><a href="/blog/archives">Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2020

    liu.shatle &hearts; gmail.com


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'shatleblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>










</body>
</html>
